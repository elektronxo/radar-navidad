yo<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Radar Navide帽o</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#00ff66">

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background: radial-gradient(circle, #003300, #000);
  color:#00ff66;
  text-align:center;
}

h1 {
  margin:20px 0 10px;
  text-shadow: 0 0 12px #00ff66;
}

#radar {
  width:300px;
  height:300px;
  border:4px solid #00ff66;
  border-radius:50%;
  margin:20px auto;
  position:relative;
  box-shadow: 0 0 30px #00ff66;
  overflow:hidden;
}

/* Anillos */
.ring {
  position:absolute;
  border:1px dashed rgba(0,255,100,0.4);
  border-radius:50%;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
}
.ring.small { width:80px; height:80px; }
.ring.medium { width:160px; height:160px; }
.ring.large { width:240px; height:240px; }

/* L铆nea radar */
#line {
  width:2px;
  height:150px;
  background:#00ff66;
  position:absolute;
  left:50%;
  bottom:50%;
  transform-origin: bottom;
  animation: spin 2s linear infinite;
  box-shadow: 0 0 12px #00ff66;
}

@keyframes spin {
  from { transform:rotate(0deg); }
  to { transform:rotate(360deg); }
}

/* Punto */
#dot {
  width:14px;
  height:14px;
  background:red;
  border-radius:50%;
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  display:none;
  box-shadow: 0 0 18px red;
  animation: pulse 1s infinite;
}

@keyframes pulse {
  0% { transform:translate(-50%,-50%) scale(1); }
  50% { transform:translate(-50%,-50%) scale(1.4); }
  100% { transform:translate(-50%,-50%) scale(1); }
}

/* Flecha */
#arrow {
  position:absolute;
  width:0;
  height:0;
  border-left:14px solid transparent;
  border-right:14px solid transparent;
  border-bottom:36px solid #00ff66;
  top:50%;
  left:50%;
  transform-origin: 50% 80%;
  transform: translate(-50%, -80%) rotate(0deg);
  filter: drop-shadow(0 0 10px #00ff66);
  display:none;
}

#status {
  font-size:22px;
  margin:15px;
}

#gpsInfo {
  font-size:14px;
  color:#7CFFB2;
  margin-top:10px;
}

button {
  font-size:20px;
  padding:15px 30px;
  background:#00ff66;
  color:#000;
  border:none;
  border-radius:14px;
  box-shadow: 0 0 12px #00ff66;
}
</style>
</head>

<body>

<h1> RADAR NAVIDEO</h1>

<div id="radar">
  <div class="ring small"></div>
  <div class="ring medium"></div>
  <div class="ring large"></div>
  <div id="line"></div>
  <div id="arrow"></div>
  <div id="dot"></div>
</div>

<p id="status">Pulsa para activar el radar</p>
<button onclick="startRadar()">ACTIVAR RADAR</button>

<div id="gpsInfo"> GPS no iniciado</div>

<!-- Sonidos -->
<audio id="beepSlow" src="beep-slow.mp3" preload="auto"></audio>
<audio id="beepFast" src="beep-fast.mp3" preload="auto"></audio>
<audio id="foundSound" src="found.mp3" preload="auto"></audio>

<script>
/*  COORDENADAS DE LAS BOLSAS */
const targets = [
  { lat: 40.000000, lon: -3.000000 },
  { lat: 40.000100, lon: -3.000100 }
];

let current = 0;
let watching = false;
let lastBeep = 0;
let deviceHeading = null;
let currentDistance = Infinity;
let radarSoundInterval = null;

const status = document.getElementById("status");
const dot = document.getElementById("dot");
const arrow = document.getElementById("arrow");
const gpsInfo = document.getElementById("gpsInfo");
const beepSlow = document.getElementById("beepSlow");
const beepFast = document.getElementById("beepFast");
const foundSound = document.getElementById("foundSound");

/* Orientaci贸n */
window.addEventListener("deviceorientationabsolute", e => {
  if (e.alpha !== null) deviceHeading = e.alpha;
});

/* Distancia */
function distance(lat1, lon1, lat2, lon2) {
  const R = 6371e3;
  const 1 = lat1 * Math.PI / 180;
  const 2 = lat2 * Math.PI / 180;
  const  = (lat2 - lat1) * Math.PI / 180;
  const 位 = (lon2 - lon1) * Math.PI / 180;
  const a =
    Math.sin(/2)**2 +
    Math.cos(1)*Math.cos(2)*Math.sin(位/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

/* Direcci贸n */
function bearing(lat1, lon1, lat2, lon2) {
  const 1 = lat1 * Math.PI / 180;
  const 2 = lat2 * Math.PI / 180;
  const 位 = (lon2 - lon1) * Math.PI / 180;
  const y = Math.sin(位) * Math.cos(2);
  const x = Math.cos(1)*Math.sin(2) -
            Math.sin(1)*Math.cos(2)*Math.cos(位);
  return (Math.atan2(y, x) * 180 / Math.PI + 360) % 360;
}

function startRadar() {
  if (watching) return;
  watching = true;

  /* Desbloqueo audio */
  beepSlow.play().then(() => {
    beepSlow.pause();
    beepSlow.currentTime = 0;
  });

  /*  Sonido por vuelta del radar */
  radarSoundInterval = setInterval(() => {
    if (currentDistance < 6) return;

    let sound = beepSlow;

    if (currentDistance < 15) {
      sound = beepFast;
    } else if (currentDistance < 40) {
      sound = beepSlow;
    } else {
      sound = beepSlow;
      sound.playbackRate = 0.7;
    }

    sound.currentTime = 0;
    sound.play();
    sound.playbackRate = 1;
  }, 2000);

  navigator.geolocation.watchPosition(pos => {

    gpsInfo.innerHTML =
      ` Lat: ${pos.coords.latitude.toFixed(6)}<br>` +
      ` Lon: ${pos.coords.longitude.toFixed(6)}<br>` +
      ` Precisi贸n: 卤${Math.round(pos.coords.accuracy)} m`;

    currentDistance = distance(
      pos.coords.latitude,
      pos.coords.longitude,
      targets[current].lat,
      targets[current].lon
    );

    if (deviceHeading !== null) {
      const b = bearing(
        pos.coords.latitude,
        pos.coords.longitude,
        targets[current].lat,
        targets[current].lon
      );
      arrow.style.display = "block";
      arrow.style.transform =
        `translate(-50%, -80%) rotate(${b - deviceHeading}deg)`;
    }

    if (currentDistance < 6) {
      status.innerText = " 隆ENERGA DETECTADA!";
      dot.style.display = "block";
      dot.style.background = "gold";
      foundSound.play();
      current = Math.min(current + 1, targets.length - 1);

    } else if (currentDistance < 15) {
      status.innerText = " 隆MUY CERCA!";
      dot.style.display = "block";
      dot.style.background = "red";

    } else if (currentDistance < 40) {
      status.innerText = " ACERCNDOSE";
      dot.style.display = "none";

    } else {
      status.innerText = " BUSCANDO ENERGA";
      dot.style.display = "none";
      arrow.style.display = "none";
    }
  });
}

/* Service Worker */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js").then(reg => {

    reg.addEventListener("updatefound", () => {
      const newWorker = reg.installing;

      newWorker.addEventListener("statechange", () => {
        if (newWorker.state === "activated") {
          console.log("Nueva versi贸n detectada, recargando...");
          window.location.reload();
        }
      });
    });

  });
}
  
</script>

</body>
</html>








